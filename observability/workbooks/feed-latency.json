{
  "version": "Notebook/1.0",
  "timeContext": {
    "durationMs": 3600000
  },
  "metadata": {
    "displayName": "Feed Performance",
    "category": "Observability",
    "description": "Track feed latency, error rate, and Cosmos request units in App Insights."
  },
  "items": [
    {
      "type": "markdown",
      "content": {
        "json": {
          "text": "## Feed Performance\nThis workbook monitors the *p50/p95/p99* latencies, the error rate, and the telemetry-based Cosmos RU budget for `/api/feed`. Update the resource IDs below to your actual `appi-asora-dev` resource before importing."
        }
      }
    },
    {
      "type": "query",
      "content": {
        "json": {
          "title": "Feed latency (p50/p95/p99)",
          "subtitle": "Latency percentiles every five minutes",
          "visualization": "linechart",
          "query": "requests\n| where url has \"/api/feed\"\n| summarize p50=percentile(duration,50), p95=percentile(duration,95), p99=percentile(duration,99) by bin(timestamp, 5m)",
          "resourceType": "microsoft.insights/components",
          "resourceIds": [
            "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/microsoft.insights/components/appi-asora-dev"
          ],
          "timeContext": {
            "durationMs": 3600000
          }
        }
      }
    },
    {
      "type": "query",
      "content": {
        "json": {
          "title": "Feed error rate",
          "subtitle": "Percentage of failed feed requests per five minutes",
          "visualization": "linechart",
          "query": "requests\n| where url has \"/api/feed\"\n| summarize err_rate=100.0 * countif(success==false) / count() by bin(timestamp, 5m)",
          "resourceType": "microsoft.insights/components",
          "resourceIds": [
            "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/microsoft.insights/components/appi-asora-dev"
          ],
          "timeContext": {
            "durationMs": 3600000
          }
        }
      }
    },
    {
      "type": "query",
      "content": {
        "json": {
          "title": "Cosmos RU per feed page",
          "subtitle": "Custom metric emitted from App Insights",
          "visualization": "linechart",
          "query": "customMetrics\n| where name == \"cosmos_ru_feed_page\"\n| summarize avgRU=avg(value), p95RU=percentile(value,95) by bin(timestamp, 5m)",
          "resourceType": "microsoft.insights/components",
          "resourceIds": [
            "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/microsoft.insights/components/appi-asora-dev"
          ],
          "timeContext": {
            "durationMs": 3600000
          }
        }
      }
    }
  ]
}
