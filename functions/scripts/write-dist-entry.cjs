#!/usr/bin/env node
const fs = require('node:fs');
const path = require('node:path');

const distDir = path.join(__dirname, '..', 'dist');
const srcEntry = path.join(distDir, 'src', 'index.js');
const destEntry = path.join(distDir, 'index.js');
const srcTypes = path.join(distDir, 'src', 'index.d.ts');
const destTypes = path.join(distDir, 'index.d.ts');
const banner = '// Auto-generated by scripts/write-dist-entry.cjs\n';

if (!fs.existsSync(srcEntry)) {
  console.error('Expected build output missing at', srcEntry);
  process.exit(1);
}

fs.mkdirSync(distDir, { recursive: true });
const jsContent = `${banner}module.exports = require('./src/index.js');\n`;
fs.writeFileSync(destEntry, jsContent, 'utf8');

if (fs.existsSync(srcTypes)) {
  const typesContent = `${banner}export * from './src/index';\n`;
  fs.writeFileSync(destTypes, typesContent, 'utf8');
}
