---
name: Mobile Release Build (Obfuscated)

on:
  workflow_dispatch:

jobs:
  build-android:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4.1.7
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      - name: Flutter pub get
        run: flutter pub get
      - name: Build Android AAB (obfuscated)
        run: |
          TS="$(date +%Y%m%d%H%M%S)"
          flutter build appbundle --release --obfuscate --split-debug-info="build/symbols/android/${TS}"
      - name: Upload artifacts
        uses: actions/upload-artifact@v4.4.0
        with:
          name: android-release
          path: |
            build/app/outputs/bundle/release/*.aab
            build/symbols/android/**

  build-ios:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4.1.7
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      - name: Flutter pub get
        run: flutter pub get
      - name: Build iOS (obfuscated)
        run: |
          TS="$(date +%Y%m%d%H%M%S)"
          flutter build ios --release --no-codesign --obfuscate --split-debug-info="build/symbols/ios/${TS}"
      - name: Upload artifacts
        uses: actions/upload-artifact@v4.4.0
        with:
          name: ios-release
          path: |
            build/ios/iphoneos/*.app
            build/symbols/ios/**
