name: asora
metadata:
  template: asora-functions-terraform
  description: Lythaus (formerly Asora) Azure deployment via azd

infra:
  provider: terraform
  path: infra

services:
  api:
    project: functions
    language: js
    host: function
    hooks:
      prepackage:
        shell: sh
        run: |
          npm ci
          npm run build
      postdeploy:
        shell: sh
        run: |
          echo "API deployed. Required app settings are managed via Key Vault references."
          echo "Ensure these are set per environment: COSMOS_CONNECTION_STRING, COSMOS_DATABASE_NAME, JWT_SECRET."

hooks:
  preprovision:
    shell: sh
    run: |
      echo "Provisioning infrastructure with Terraform in ./infra"
      echo "Select workspace before azd provision (dev|stage|prod) if needed."
