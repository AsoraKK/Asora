# Asora Security Secrets Audit (Day 1)

This report summarizes a read-only scan of the repository and workspace for hard-coded secrets and secret-handling posture.

## Scope and method
- Reviewed tracked files via git and untracked workspace files where present.
- Grepped for common secret names and high-entropy values across source, docs, workflows, and Infra folder.
- Verified Azure Function App settings and Key Vault references in IaC.
- Reviewed GitHub Actions authentication model.

## Findings summary
- Tracked source/workflows: No hard-coded credentials found in tracked code or workflows.
- Untracked local files (present in workspace): Contain sensitive secrets in plaintext. These are correctly ignored by .gitignore but should be handled cautiously.
- IaC: Key Vault references are configured for runtime settings; good posture. A local Terraform state backup contains sensitive data and should be kept out of VCS and removed from working dir when not needed.
- CI: GitHub Actions uses OIDC with azure/login@v2; no long-lived cloud credentials checked in.

## Details and evidence

1) local.settings.json (untracked)
- Path: `local.settings.json`
- Status: Untracked (ignored by .gitignore). Not found in git history.
- Contains: POSTGRES_PASSWORD, COSMOS_KEY, JWT_SECRET in plaintext for local development.
  - Example keys detected at lines 6–8 (values not reproduced here).
- Risk: Low if never committed or exfiltrated; still sensitive.
- Action: Keep untracked. Prefer using environment variables locally. Consider using a local .env (also ignored) or Azure Functions Core Tools secrets store.

2) Infra/terraform.tfvars (untracked)
- Path: `Infra/terraform.tfvars`
- Status: Untracked (ignored). Not found in git history.
- Contains: `subscription_id` and `postgresql_password` (plaintext).
- Risk: Low if kept local and never committed; still sensitive.
- Action: Keep untracked. Consider storing sensitive vars in Azure Key Vault and referencing via TF data sources or environment variables passed at apply time.

3) Infra/terraform.tfstate.backup (untracked)
- Path: `Infra/terraform.tfstate.backup`
- Status: Untracked (ignored). Not found in git history.
- Contains: Cosmos DB primary/readonly keys, connection strings, and resource IDs.
- Risk: High if exposed. State files often include secrets by design.
- Action: Do not commit. Remove from local workspace after use. Store state remotely (already configured via `backend "azurerm"`) and avoid keeping local copies.

4) GitHub Actions CI/CD
- Workflow: `.github/workflows/deploy-functionapp.yml`
- Posture: OIDC with `azure/login@v2` and `permissions: id-token: write`.
- No service principal secrets present. Azure identifiers are pulled from repo secrets, not credentials. Good posture.

5) Azure Function App settings via Key Vault
- IaC: `Infra/function_app.tf` wires app settings to Key Vault references:
  - COSMOS_ENDPOINT, COSMOS_KEY, JWT_SECRET, HIVE_TEXT_KEY, HIVE_IMAGE_KEY, HIVE_DEEPFAKE_KEY.
- Key Vault secret resources defined in `Infra/key_vault.tf` for the above.
- Posture: Correct pattern using Key Vault references in app settings.

## Git tracking checks (summary)
- Tracked now: `gh-deployer-sp.json` (empty placeholder); safe.
- Not tracked and not found in history: `local.settings.json`, `Infra/terraform.tfvars` (verified via `git ls-files` and `git log -- <path>`).
- Not tracked: `Infra/terraform.tfstate.backup` and other TF state artifacts (correctly ignored by .gitignore).

## Recommendations
- Continue to keep `local.settings.json`, TF vars/state files untracked. Never commit them.
- Delete local `Infra/terraform.tfstate.backup` once no longer needed. Rely on remote backend.
- Rotate Cosmos keys and Postgres password only if any of the untracked files were ever committed, shared, or copied outside this machine. Otherwise, no immediate rotation required.
- Add a short “Local Secrets Handling” section to README explaining use of `local.settings.json.example` and environment variables.
- Consider pre-commit safeguards:
  - `git-secrets` or `pre-commit` hooks to scan for secret patterns.
  - Optional: use `dotenv`-style local dev with `.env` (already ignored) to avoid editing `local.settings.json`.

## Remediation checklist
- [ ] Confirm no accidental commits for: `local.settings.json`, `Infra/terraform.tfvars`, `Infra/terraform.tfstate*`.
- [ ] Remove `Infra/terraform.tfstate.backup` from working dir after validation.
- [ ] If exposure suspected, rotate: Cosmos keys (primary + read-only), Postgres password, JWT secret.
- [ ] Keep Azure OIDC workflow; avoid adding client secrets.
- [ ] Keep Key Vault references in app settings; add any new secrets there (e.g., future Redis credentials).

---
Generated by automated read-only audit.
